{% extends 'base.html' %}
{% load static %}

{% block title %}Health Passport - ShareMyCare{% endblock %}

{% block content %}
<div class="book-container">
    <div class="book-controls">
        <button class="book-btn prev-btn" onclick="turnPage(-1)" id="prevBtn">‚Üê Previous</button>
        <span class="page-indicator">
            <span id="currentPage">1</span> / <span id="totalPages">4</span>
        </span>
        <button class="book-btn next-btn" onclick="turnPage(1)" id="nextBtn">Next ‚Üí</button>
    </div>

    <div class="book-wrapper">
        <div class="book" id="healthBook">
            <!-- Spread 1: Cover (left) + Personal Info (right) -->
            <div class="page cover-page">
                <div class="page-content">
                    <div class="cover-design">
                        <div class="passport-title-large">HEALTH PASSPORT</div>
                        <div class="passport-subtitle-large">ShareMyCare</div>
                        <div class="cover-icon">üìò</div>
                        <div class="cover-name">
                            {% if is_clinician_view %}
                                {{ patient.get_full_name|default:patient.username }}
                            {% else %}
                                {{ profile.user.get_full_name|default:profile.user.username }}
                            {% endif %}
                        </div>
                        {% if profile.date_of_birth %}
                            <div class="cover-dob">Born: {{ profile.date_of_birth|date:"F d, Y" }}</div>
                        {% elif is_clinician_view and patient.profile.date_of_birth %}
                            <div class="cover-dob">Born: {{ patient.profile.date_of_birth|date:"F d, Y" }}</div>
                        {% endif %}
                        <div class="cover-stamp">OFFICIAL</div>
                    </div>
                </div>
            </div>

            <!-- Page 1: Personal Information (right side of spread 1) -->
            <div class="page">
                <div class="page-content">
                    <div class="page-header">
                        <h2 class="page-title">Personal Information</h2>
                        <div class="page-number">1</div>
                    </div>
                    <div class="page-body">
                        <div class="info-section">
                            <div class="info-row">
                                <span class="info-label">Full Name:</span>
                                <span class="info-value">{{ profile.user.get_full_name|default:profile.user.username }}</span>
                            </div>
                            {% if profile.date_of_birth %}
                            <div class="info-row">
                                <span class="info-label">Date of Birth:</span>
                                <span class="info-value">{{ profile.date_of_birth|date:"F d, Y" }}</span>
                            </div>
                            {% endif %}
                            {% if profile.phone_number %}
                            <div class="info-row">
                                <span class="info-label">Phone:</span>
                                <span class="info-value">{{ profile.phone_number }}</span>
                            </div>
                            {% endif %}
                            <div class="info-row">
                                <span class="info-label">Email:</span>
                                <span class="info-value">{{ profile.user.email }}</span>
                            </div>
                        </div>
                        
                        {% if profile.emergency_contact_name %}
                        <div class="info-section emergency-section">
                            <h3 class="section-title">Emergency Contact</h3>
                            <div class="info-row">
                                <span class="info-label">Name:</span>
                                <span class="info-value">{{ profile.emergency_contact_name }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Relationship:</span>
                                <span class="info-value">{{ profile.emergency_contact_relationship }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Phone:</span>
                                <span class="info-value emergency-phone">{{ profile.emergency_contact_phone }}</span>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if not is_clinician_view %}
                        <div class="page-footer">
                            <a href="{% url 'health_records:edit_profile' %}" class="btn btn-primary btn-sm">Edit Profile</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Page 2: Medications -->
            <div class="page">
                <div class="page-content">
                    <div class="page-header">
                        <h2 class="page-title">Current Medications</h2>
                        <div class="page-number">2</div>
                    </div>
                    <div class="page-body">
                        {% if medications %}
                            <div class="medications-list">
                                {% for med in medications %}
                                    <div class="medication-entry">
                                        <div class="entry-header">
                                            <strong class="med-name">{{ med.name }}</strong>
                                            {% if med.is_active %}
                                                <span class="status-badge active">Active</span>
                                            {% else %}
                                                <span class="status-badge inactive">Inactive</span>
                                            {% endif %}
                                        </div>
                                        <div class="entry-details">
                                            {% if med.dosage %}<span>Dosage: {{ med.dosage }}</span>{% endif %}
                                            {% if med.frequency %}<span>Frequency: {{ med.frequency }}</span>{% endif %}
                                            {% if med.is_prescribed %}
                                                <span class="prescribed-badge">Prescribed</span>
                                            {% else %}
                                                <span class="prescribed-badge non-prescribed">Non-prescribed</span>
                                            {% endif %}
                                        </div>
                                        {% if med.notes %}
                                            <p class="entry-notes">{{ med.notes }}</p>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-state">
                                <div class="empty-icon">üíä</div>
                                <h3>No Medications Recorded</h3>
                                <p>You haven't added any medications yet. Add your medications to keep your health passport complete.</p>
                            </div>
                        {% endif %}
                        {% if not is_clinician_view %}
                        <div class="page-footer">
                            <a href="{% url 'health_records:add_medication' %}" class="btn btn-primary btn-sm">Add Medication</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Page 3: Medical Conditions -->
            <div class="page">
                <div class="page-content">
                    <div class="page-header">
                        <h2 class="page-title">Medical Conditions</h2>
                        <div class="page-number">3</div>
                    </div>
                    <div class="page-body">
                        {% if conditions %}
                            <div class="conditions-list">
                                {% for condition in conditions %}
                                    <div class="condition-entry">
                                        <div class="entry-header">
                                            <strong class="condition-name">{{ condition.name }}</strong>
                                            <span class="status-badge status-{{ condition.status }}">{{ condition.get_status_display }}</span>
                                        </div>
                                        {% if condition.diagnosis_date %}
                                            <div class="entry-details">
                                                <span>Diagnosed: {{ condition.diagnosis_date|date:"F Y" }}</span>
                                            </div>
                                        {% endif %}
                                        {% if condition.notes %}
                                            <p class="entry-notes">{{ condition.notes }}</p>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-state">
                                <div class="empty-icon">üè•</div>
                                <h3>No Conditions Recorded</h3>
                                <p>You haven't added any medical conditions yet. Add your conditions to keep your health passport complete.</p>
                            </div>
                        {% endif %}
                        {% if not is_clinician_view %}
                        <div class="page-footer">
                            <a href="{% url 'health_records:add_condition' %}" class="btn btn-primary btn-sm">Add Condition</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Page 4: Allergies -->
            <div class="page">
                <div class="page-content">
                    <div class="page-header">
                        <h2 class="page-title">Allergies</h2>
                        <div class="page-number">4</div>
                    </div>
                    <div class="page-body">
                        {% if allergies %}
                            <div class="allergies-list">
                                {% for allergy in allergies %}
                                    <div class="allergy-entry severity-{{ allergy.severity }}">
                                        <div class="entry-header">
                                            <strong class="allergy-name">{{ allergy.allergen }}</strong>
                                            {% if allergy.severity %}
                                                <span class="severity-badge severity-{{ allergy.severity }}">
                                                    {{ allergy.get_severity_display }}
                                                </span>
                                            {% endif %}
                                        </div>
                                        {% if allergy.reaction %}
                                            <div class="entry-details">
                                                <span><strong>Reaction:</strong> {{ allergy.reaction }}</span>
                                            </div>
                                        {% endif %}
                                        {% if allergy.date_identified %}
                                            <div class="entry-details">
                                                <span>Identified: {{ allergy.date_identified|date:"F Y" }}</span>
                                            </div>
                                        {% endif %}
                                        {% if allergy.notes %}
                                            <p class="entry-notes">{{ allergy.notes }}</p>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-state">
                                <div class="empty-icon">‚ö†Ô∏è</div>
                                <h3>No Allergies Recorded</h3>
                                <p>You haven't added any allergies yet. It's important to record all known allergies for emergency situations.</p>
                            </div>
                        {% endif %}
                        {% if not is_clinician_view %}
                        <div class="page-footer">
                            <a href="{% url 'health_records:add_allergy' %}" class="btn btn-primary btn-sm">Add Allergy</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Page 5: Recent Assessments -->
            <div class="page">
                <div class="page-content">
                    <div class="page-header">
                        <h2 class="page-title">Recent Assessments</h2>
                        <div class="page-number">5</div>
                    </div>
                    <div class="page-body">
                        {% if assessments %}
                            <div class="assessments-list">
                                {% for assessment in assessments %}
                                    <div class="assessment-entry">
                                        <div class="entry-header">
                                            <strong>{{ assessment.assessment_date|date:"F d, Y"|default:"Recent Assessment" }}</strong>
                                            {% if assessment.assessment_type %}
                                                <span class="type-badge">{{ assessment.get_assessment_type_display }}</span>
                                            {% endif %}
                                        </div>
                                        {% if assessment.clinician %}
                                            <div class="entry-details">
                                                <span>By: {{ assessment.clinician.full_name }}</span>
                                            </div>
                                        {% endif %}
                                        {% if assessment.objective_findings %}
                                            <p class="entry-notes">{{ assessment.objective_findings|truncatewords:30 }}</p>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-state">
                                <div class="empty-icon">üìã</div>
                                <h3>No Assessments Recorded</h3>
                                <p>You haven't added any health assessments yet. Add assessments to track your health over time.</p>
                            </div>
                        {% endif %}
                        {% if not is_clinician_view %}
                        <div class="page-footer">
                            <a href="{% url 'health_records:add_assessment' %}" class="btn btn-primary btn-sm">Add Assessment</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Back Cover -->
            <div class="page cover-page back-cover">
                <div class="page-content">
                    <div class="cover-design">
                        <div class="cover-icon">üìò</div>
                        <div class="cover-stamp">ShareMyCare</div>
                        <div class="cover-footer">
                            <p>Your Digital Health Passport</p>
                            <p>Keep this information up to date</p>
                        </div>
                        <div class="cover-qr-placeholder">
                            <div class="qr-icon">üì±</div>
                            <p>QR Code</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="book-actions">
        {% if is_clinician_view %}
            <a href="{% url 'clinicians:client_detail' patient.id %}" class="btn btn-secondary">‚Üê Back to Client</a>
        {% else %}
            <a href="{% url 'health_records:dashboard' %}" class="btn btn-secondary">Back to Dashboard</a>
            <a href="{% url 'health_records:emergency_card' %}" class="btn btn-primary">Emergency Card</a>
        {% endif %}
    </div>
</div>

<style>
.book-container {
    max-width: 100%;
    margin: 2rem auto;
    padding: 0 1rem;
    padding-bottom: 100px;
}

.book-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 2rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

@media (max-width: 768px) {
    .book-controls {
        gap: 1rem;
        flex-wrap: nowrap;
    }
    
    .book-btn {
        flex: 1;
        max-width: 150px;
    }
    
    .page-indicator {
        min-width: 60px;
        font-size: 1rem;
    }
}

.book-btn {
    padding: 0.75rem 1.5rem;
    background: linear-gradient(135deg, var(--healthcare-primary) 0%, var(--primary-color) 100%);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 
        0 4px 8px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.3),
        inset 0 -1px 0 rgba(0, 0, 0, 0.15);
}

.book-btn:hover:not(:disabled) {
    background: linear-gradient(135deg, var(--healthcare-primary-hover) 0%, var(--primary-hover) 100%);
    transform: translateY(-2px);
    box-shadow: 
        0 6px 12px rgba(0, 0, 0, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.35),
        inset 0 -1px 0 rgba(0, 0, 0, 0.2);
}

.book-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.page-indicator {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
    min-width: 80px;
    text-align: center;
}


.book-wrapper {
    perspective: 2000px;
    margin: 2rem 0;
    display: flex;
    justify-content: center;
}

.book {
    width: 800px;
    height: 600px;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s;
}

.page {
    position: absolute;
    width: 50%;
    height: 100%;
    background: #f5f5f5;
    border: 1px solid #ddd;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    transform-origin: left center;
    transition: transform 0.6s ease;
    backface-visibility: hidden;
}

.page:nth-child(odd) {
    left: 0;
    border-right: 2px solid #ccc;
}

.page:nth-child(even) {
    right: 0;
    border-left: 2px solid #ccc;
    transform-origin: right center;
}

.page-content {
    width: 100%;
    height: 100%;
    padding: 2rem;
    overflow-y: auto;
    background: white;
}

/* Cover Pages */
.cover-page {
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    color: white;
}

.cover-page .page-content {
    background: transparent;
    display: flex;
    align-items: center;
    justify-content: center;
}

.cover-design {
    text-align: center;
    width: 100%;
}

.passport-title-large {
    font-size: 2.5rem;
    font-weight: 700;
    letter-spacing: 4px;
    margin-bottom: 1rem;
    text-transform: uppercase;
}

.passport-subtitle-large {
    font-size: 1.5rem;
    margin-bottom: 2rem;
    opacity: 0.9;
}

.cover-icon {
    font-size: 5rem;
    margin: 2rem 0;
}

.cover-name {
    font-size: 1.75rem;
    font-weight: 600;
    margin: 1.5rem 0;
}

.cover-dob {
    font-size: 1.125rem;
    opacity: 0.9;
    margin-bottom: 2rem;
}

.cover-stamp {
    font-size: 1.25rem;
    font-weight: 700;
    letter-spacing: 3px;
    border: 3px solid white;
    padding: 0.75rem 2rem;
    display: inline-block;
    margin-top: 2rem;
}

.back-cover {
    background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
}

.cover-footer {
    margin-top: 3rem;
    font-size: 1rem;
    opacity: 0.9;
}

.cover-qr-placeholder {
    margin-top: 3rem;
    padding: 2rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    display: inline-block;
}

.qr-icon {
    font-size: 3rem;
    margin-bottom: 0.5rem;
}

/* Regular Pages */
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--border-color);
}

.page-title {
    font-size: 1.75rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.page-number {
    font-size: 0.875rem;
    color: var(--text-secondary);
    font-weight: 500;
}

.page-body {
    min-height: 400px;
}

.info-section {
    margin-bottom: 2rem;
}

.info-row {
    display: flex;
    justify-content: space-between;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--bg-light);
}

.info-label {
    font-weight: 600;
    color: var(--text-secondary);
}

.info-value {
    color: var(--text-primary);
    text-align: right;
}

.emergency-section {
    background: #fff3cd;
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid #ffc107;
    margin-top: 2rem;
}

.emergency-phone {
    color: #dc3545;
    font-weight: 700;
}

.section-title {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--text-primary);
}

/* Lists */
.medications-list,
.conditions-list,
.allergies-list,
.assessments-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.medication-entry,
.condition-entry,
.allergy-entry,
.assessment-entry {
    padding: 1.25rem;
    background: var(--bg-light);
    border-radius: 8px;
    border-left: 4px solid var(--primary-color);
}

.entry-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
}

.entry-details {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    font-size: 0.9375rem;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
}

.entry-notes {
    margin-top: 0.75rem;
    font-size: 0.9375rem;
    color: var(--text-primary);
    line-height: 1.6;
}

.status-badge,
.severity-badge,
.type-badge,
.prescribed-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
}

.status-badge.active {
    background: #4caf50;
    color: white;
}

.status-badge.inactive {
    background: #9e9e9e;
    color: white;
}

.severity-badge.severity-mild {
    background: #fff3cd;
    color: #856404;
}

.severity-badge.severity-moderate {
    background: #ffeaa7;
    color: #d63031;
}

.severity-badge.severity-severe {
    background: #ff6b6b;
    color: white;
}

.prescribed-badge {
    background: #e3f2fd;
    color: #1976d2;
}

.prescribed-badge.non-prescribed {
    background: #f3e5f5;
    color: #7b1fa2;
}

.allergy-entry.severity-severe {
    border-left-color: #dc3545;
    background: #ffe5e5;
}

.page-footer {
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border-color);
    text-align: center;
}

.empty-state {
    text-align: center;
    padding: 2rem 1rem;
    color: var(--text-secondary);
    min-height: 300px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.empty-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.empty-state h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 0.75rem 0;
}

.empty-state p {
    font-size: 0.9375rem;
    line-height: 1.6;
    max-width: 400px;
    margin: 0;
    color: var(--text-secondary);
}

.book-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 2rem;
    flex-wrap: wrap;
}

/* Page Turning Animation */
.page.turned {
    transform: rotateY(-180deg);
}

.page.turned:nth-child(even) {
    transform: rotateY(180deg);
}

@media (max-width: 1024px) {
    .book {
        width: 100%;
        max-width: 600px;
        height: 500px;
    }
}

@media (max-width: 768px) {
    /* Mobile: Show one page at a time instead of two */
    .book {
        height: 500px;
        width: 100%;
        max-width: 100%;
    }
    
    .page {
        width: 100% !important;
        left: 0 !important;
        right: 0 !important;
        border-left: none !important;
        border-right: none !important;
    }
    
    .page:nth-child(even) {
        right: 0;
        left: 0;
        transform-origin: left center;
    }
    
    .page-content {
        padding: 1.5rem;
    }
    
    .passport-title-large {
        font-size: 1.75rem;
    }
    
    .page-title {
        font-size: 1.25rem;
    }
    
    .book-controls {
        gap: 1rem;
    }
    
    .book-btn {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
    }
    
    /* Update JavaScript for mobile - show one page at a time */
    .page.turned {
        display: none !important;
    }
}

@media (max-width: 480px) {
    .book {
        height: 400px;
    }
    
    .page-content {
        padding: 1rem;
    }
    
    .passport-title-large {
        font-size: 1.5rem;
    }
    
    .cover-icon {
        font-size: 3rem;
    }
    
    .empty-icon {
        font-size: 3rem;
    }
}
</style>

<script>
let currentSpread = 0;
// Total spreads: 
// Spread 0: Cover (page 0) + Personal Info (page 1)
// Spread 1: Medications (page 2) + Conditions (page 3)
// Spread 2: Allergies (page 4) + Assessments (page 5)
// Spread 3: Back Cover (page 6) - shown alone
const totalSpreads = 4;
const pages = document.querySelectorAll('.page');

document.getElementById('totalPages').textContent = totalSpreads;

function updatePageDisplay() {
    const isMobile = window.innerWidth <= 768;
    
    if (isMobile) {
        // Mobile: Show one page at a time (7 pages total)
        const totalMobilePages = 7;
        document.getElementById('totalPages').textContent = totalMobilePages;
        document.getElementById('currentPage').textContent = currentSpread + 1;
        
        // Update button states
        document.getElementById('prevBtn').disabled = currentSpread === 0;
        document.getElementById('nextBtn').disabled = currentSpread >= totalMobilePages - 1;
        
        // Show only the current page
        pages.forEach((page, index) => {
            if (index === currentSpread) {
                page.style.display = 'block';
                page.classList.remove('turned');
            } else {
                page.style.display = 'none';
                page.classList.add('turned');
            }
        });
    } else {
        // Desktop: Show pages in pairs (spreads)
        document.getElementById('totalPages').textContent = totalSpreads;
        document.getElementById('currentPage').textContent = currentSpread + 1;
        
        // Update button states
        document.getElementById('prevBtn').disabled = currentSpread === 0;
        document.getElementById('nextBtn').disabled = currentSpread >= totalSpreads - 1;
        
        // Show pages in pairs (spreads)
        pages.forEach((page, index) => {
            if (currentSpread === 0) {
                // Spread 0: Cover (0) + Personal Info (1)
                if (index === 0 || index === 1) {
                    page.style.display = 'block';
                    page.classList.remove('turned');
                } else {
                    page.style.display = 'block';
                    page.classList.add('turned');
                }
            } else if (currentSpread === 1) {
                // Spread 1: Medications (2) + Conditions (3)
                if (index === 2 || index === 3) {
                    page.style.display = 'block';
                    page.classList.remove('turned');
                } else if (index < 2) {
                    page.style.display = 'block';
                    page.classList.add('turned');
                } else {
                    page.style.display = 'block';
                    page.classList.add('turned');
                }
            } else if (currentSpread === 2) {
                // Spread 2: Allergies (4) + Assessments (5)
                if (index === 4 || index === 5) {
                    page.style.display = 'block';
                    page.classList.remove('turned');
                } else if (index < 4) {
                    page.style.display = 'block';
                    page.classList.add('turned');
                } else {
                    page.style.display = 'block';
                    page.classList.add('turned');
                }
            } else if (currentSpread === 3) {
                // Spread 3: Back Cover (6) - show alone
                if (index === 6) {
                    page.style.display = 'block';
                    page.classList.remove('turned');
                } else {
                    page.style.display = 'block';
                    page.classList.add('turned');
                }
            }
        });
    }
}

// Update on window resize
window.addEventListener('resize', function() {
    updatePageDisplay();
});

function turnPage(direction) {
    const isMobile = window.innerWidth <= 768;
    let maxPages;
    
    if (isMobile) {
        maxPages = 7; // 7 individual pages on mobile
    } else {
        maxPages = totalSpreads; // 4 spreads on desktop
    }
    
    const newIndex = currentSpread + direction;
    if (newIndex >= 0 && newIndex < maxPages) {
        currentSpread = newIndex;
        updatePageDisplay();
    }
}

// Initialize
updatePageDisplay();

// Keyboard navigation
document.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowLeft') {
        turnPage(-1);
    } else if (e.key === 'ArrowRight') {
        turnPage(1);
    }
});

// Touch swipe support
let touchStartX = 0;
let touchEndX = 0;

document.querySelector('.book-wrapper').addEventListener('touchstart', function(e) {
    touchStartX = e.changedTouches[0].screenX;
});

document.querySelector('.book-wrapper').addEventListener('touchend', function(e) {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
});

function handleSwipe() {
    if (touchEndX < touchStartX - 50) {
        turnPage(1); // Swipe left - next page
    }
    if (touchEndX > touchStartX + 50) {
        turnPage(-1); // Swipe right - previous page
    }
}
</script>
{% endblock %}
